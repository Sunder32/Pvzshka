# üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Ä–æ—É—Ç–∏–Ω–≥

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 1: –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ß—Ç–æ –±—ã–ª–æ:**
- GraphQL query –∑–∞–≥—Ä—É–∂–∞–ª –¥–∞–Ω–Ω—ã–µ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–∞ —Å–∞–π—Ç–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥** (`pollInterval: 5000`)
2. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ tenant** (`refetch()`)
3. **–ó–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞** (`fetchPolicy: 'network-only'`)
4. **–ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ** –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é

**–§–∞–π–ª:** `Frontend/web-app/src/components/DynamicSite.tsx`

```tsx
const { data, loading, error, refetch } = useQuery(GET_SITE_CONFIG, {
  variables: { tenantId },
  fetchPolicy: 'network-only',  // –í—Å–µ–≥–¥–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
  pollInterval: 5000,            // –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
})

useEffect(() => {
  refetch()  // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ tenantId
}, [tenantId, refetch])
```

---

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ 2: 404 –æ—à–∏–±–∫–∞ –Ω–∞ /market/testt

**–ß—Ç–æ –±—ã–ª–æ:**
- –°—Ç–∞—Ä—ã–π –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å config-service API
- –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –Ω–æ–≤–æ–π GraphQL –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ **client component** ('use client')
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **DynamicSite** —Å GraphQL
3. **–ú–∞–ø–ø–∏–Ω–≥ —Å—É–±–¥–æ–º–µ–Ω–æ–≤** –Ω–∞ UUID

**–§–∞–π–ª:** `Frontend/web-app/src/app/market/[tenant]/page.tsx`

```tsx
'use client'

const getTenantId = (subdomain: string): string => {
  const tenantMap: Record<string, string> = {
    'demo': '00000000-0000-0000-0000-000000000001',
    'test': '00000000-0000-0000-0000-000000000001',
    'testt': '00000000-0000-0000-0000-000000000001',
  };
  return tenantMap[subdomain.toLowerCase()] || '00000000-0000-0000-0000-000000000001';
};
```

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:

```
0s  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Site Builder
‚Üì
1s  - GraphQL mutation –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ PostgreSQL
‚Üì
2s  - Config-service –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–µ—à
‚Üì
0-5s - DynamicSite –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (pollInterval)
‚Üì
5s  - –°–∞–π—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: **5 —Å–µ–∫—É–Ω–¥**

---

## üöÄ –î–æ—Å—Ç—É–ø–Ω—ã–µ URL

### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:
- **http://localhost:3003** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Demo Shop (UUID: 0000...0001)
- Auto-refresh –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã:
- **http://localhost:3003/market/demo** ‚úÖ
- **http://localhost:3003/market/test** ‚úÖ
- **http://localhost:3003/market/testt** ‚úÖ
- **http://localhost:3003/market/–ª—é–±–æ–µ-–∏–º—è** ‚úÖ

–í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã /market/* –º–∞–ø–ø—è—Ç—Å—è –Ω–∞ Demo Shop UUID.

---

## üõ†Ô∏è –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ

### –ö–Ω–æ–ø–∫–∏ –≤ —Ç—É–ª–±–∞—Ä–µ:

| –ö–Ω–æ–ø–∫–∞ | –î–µ–π—Å—Ç–≤–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|--------|----------|-------------------|
| üíª Desktop | –ü—Ä–µ–≤—å—é –Ω–∞ desktop | –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∏—Ä–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ |
| üì± Tablet | –ü—Ä–µ–≤—å—é –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–µ–¥–Ω–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ |
| üì± Mobile | –ü—Ä–µ–≤—å—é –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º | –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ |
| ‚Ü©Ô∏è –û—Ç–º–µ–Ω–∏—Ç—å | –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É | –°–±—Ä–æ—Å–∏—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è |
| ‚òÅÔ∏è **–û–±–Ω–æ–≤–∏—Ç—å** | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é | –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –≤–∏–¥–Ω—ã |
| üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î | –ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| üëÅÔ∏è –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å + –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å | –ì–æ—Ç–æ–≤–æ –∫ –ø–æ–∫–∞–∑—É |

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

1. **Polling —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∫—Ä—ã—Ç–æ–π –≤–∫–ª–∞–¥–∫–µ
   - –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

2. **Network-only fetchPolicy**
   - –û–±—Ö–æ–¥–∏—Ç Apollo Cache
   - –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

3. **Debouncing –¥–ª—è –ø—Ä–µ–≤—å—é**
   - –ò–∑–±–µ–≥–∞–µ—Ç –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫
   - –ü–ª–∞–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ UI

---

## üîß –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ –µ—â–µ –Ω–µ –≤–∏–¥–Ω—ã

### –ß–µ–∫–ª–∏—Å—Ç:

1. ‚úÖ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–û–±–Ω–æ–≤–∏—Ç—å"** –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è **—Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã** (–∫–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")
3. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí XHR ‚Üí –∏—â–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ GraphQL
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
5. ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–∞–π—Ç–∞ (Ctrl+Shift+R)
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ config-service –∑–∞–ø—É—â–µ–Ω: `docker ps | grep config-service`

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps

# –õ–æ–≥–∏ config-service
docker logs pvzzz-config-service-1 --tail 50

# –õ–æ–≥–∏ web-app
docker logs pvzzz-web-app-1 --tail 50

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ web-app
docker-compose restart web-app
```

---

## üé® –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ò–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞ Hero —Å–µ–∫—Ü–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ **http://localhost:3001/site-builder**
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–Ω–∞–Ω—Ç "Demo Shop"
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ Hero —Å–µ–∫—Ü–∏—é
4. –ò–∑–º–µ–Ω–∏—Ç–µ "–¶–≤–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (–Ω–∞—á–∞–ª–æ)" –Ω–∞ `#ff6b6b`
5. –ò–∑–º–µ–Ω–∏—Ç–µ "–¶–≤–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (–∫–æ–Ω–µ—Ü)" –Ω–∞ `#4ecdc4`
6. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**
7. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5 —Å–µ–∫—É–Ω–¥ –ò–õ–ò –Ω–∞–∂–º–∏—Ç–µ **"–û–±–Ω–æ–≤–∏—Ç—å"**
8. –û—Ç–∫—Ä–æ–π—Ç–µ **http://localhost:3003** –∏–ª–∏ **http://localhost:3003/market/testt**
9. ‚ú® –í–∏–¥–∏—Ç–µ –Ω–æ–≤—ã–µ —Ü–≤–µ—Ç–∞!

---

## üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–∏–Ω–≥–∞

### –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç:

```bash
# –ì–ª–∞–≤–Ω–∞—è (–∫–æ—Ä–µ–Ω—å)
http://localhost:3003

# Market routes
http://localhost:3003/market/demo
http://localhost:3003/market/test
http://localhost:3003/market/testt
http://localhost:3003/market/any-name-here

# Catalog (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
http://localhost:3003/catalog

# Product (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
http://localhost:3003/product/123
```

---

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

1. **WebSocket –¥–ª—è real-time updates** (0 —Å–µ–∫—É–Ω–¥ –∑–∞–¥–µ—Ä–∂–∫–∏)
2. **Server-Sent Events** –¥–ª—è push –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
3. **–ö–Ω–æ–ø–∫–∞ "Live Preview"** —Å WebSocket
4. **Subdomain resolution** —á–µ—Ä–µ–∑ API (–≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞)
5. **Cache invalidation** –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

- ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (5 —Å–µ–∫)
- ‚úÖ /market/testt —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–æ–±–∞–≤–ª–µ–Ω–∞
- ‚úÖ –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã
- ‚úÖ GraphQL polling –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
