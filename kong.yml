_format_version: "3.0"

services:
  - name: web-app
    url: http://web-app:3000
    routes:
      - name: web-app-route
        paths:
          - /
        strip_path: false
        
  - name: config-service
    url: http://config-service:4001
    routes:
      - name: config-route
        paths:
          - /graphql
        strip_path: false

  - name: catalog-service
    url: http://catalog-service:4002
    routes:
      - name: catalog-route
        paths:
          - /api/products
          - /api/categories
        strip_path: false

  - name: order-service
    url: http://order-service:4003
    routes:
      - name: order-route
        paths:
          - /api/orders
        strip_path: false

  - name: payment-service
    url: http://payment-service:4004
    routes:
      - name: payment-route
        paths:
          - /api/payments
        strip_path: false

  - name: logistics-service
    url: http://logistics-service:4005
    routes:
      - name: logistics-route
        paths:
          - /api/shipments
          - /api/pvz
        strip_path: false

  - name: notification-service
    url: http://notification-service:4006
    routes:
      - name: notification-route
        paths:
          - /api/notifications
        strip_path: false

plugins:
  - name: cors
    config:
      origins:
        - http://localhost:3000
        - http://localhost:3001
        - http://localhost:3002
        - http://localhost:3003
        - http://localhost:8000
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
        - PATCH
      headers:
        - Accept
        - Authorization
        - Content-Type
        - X-Tenant-ID
        - X-User-ID
      credentials: true
      exposed_headers:
        - X-Total-Count

  - name: rate-limiting
    config:
      minute: 1000
      hour: 10000
      policy: local
