_format_version: "3.0"

services:
  - name: config-service
    url: http://config-service:4001
    routes:
      - name: config-route
        paths:
          - /graphql
        strip_path: false

  - name: catalog-service
    url: http://catalog-service:4002
    routes:
      - name: catalog-route
        paths:
          - /api/products
          - /api/categories
        strip_path: false

  - name: order-service
    url: http://order-service:4003
    routes:
      - name: order-route
        paths:
          - /api/orders
        strip_path: false

  - name: payment-service
    url: http://payment-service:4004
    routes:
      - name: payment-route
        paths:
          - /api/payments
        strip_path: false

  - name: logistics-service
    url: http://logistics-service:4005
    routes:
      - name: logistics-route
        paths:
          - /api/shipments
          - /api/pvz
        strip_path: false

  - name: notification-service
    url: http://notification-service:4006
    routes:
      - name: notification-route
        paths:
          - /api/notifications
        strip_path: false

plugins:
  - name: rate-limiting
    config:
      minute: 100
      hour: 1000
      policy: local

  - name: cors
    config:
      origins:
        - http://localhost:3000
        - http://localhost:3001
        - http://localhost:3002
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      headers:
        - Accept
        - Authorization
        - Content-Type
      credentials: true

  - name: jwt
    config:
      claims_to_verify:
        - exp
      key_claim_name: kid
